@page "/barcos"
@attribute [Authorize]

@using CRM.Dtos
@using System.Linq

@* <div class="flex min-h-screen">
    <aside class="w-[var(--sidebar-width)] bg-slate-900 text-slate-300 flex flex-col border-r border-slate-800 sticky top-0 h-screen">
        <div class="p-6">
            <div class="flex items-center gap-3">
                <div class="w-10 h-10 bg-sky-500 rounded-lg flex items-center justify-center">
                    <span class="material-symbols-outlined text-white">sailing</span>
                </div>
                <div>
                    <h2 class="font-bold text-white text-lg leading-none tracking-tight">MARITIME</h2>
                    <span class="text-[10px] text-slate-500 font-mono">Guild Admin Portal</span>
                </div>
            </div>
        </div>
        <nav class="flex-1 px-4 space-y-1">
            <div class="pb-2 px-2">
               <span class="text-[10px] font-bold text-slate-500 uppercase tracking-widest">General</span>
           </div>
           <a class="flex items-center gap-3 px-3 py-2.5 rounded-lg hover:bg-slate-800 transition-colors" href="#">
                <span class="material-symbols-outlined text-xl">dashboard</span>
                <span class="text-sm font-medium">Dashboard</span>
            </a>
            <a class="flex items-center gap-3 px-3 py-2.5 rounded-lg bg-sky-600/10 text-sky-400 border border-sky-500/20 transition-colors" href="#">
                <span class="material-symbols-outlined text-xl italic">corporate_fare</span>
                <span class="text-sm font-bold tracking-tight italic">Empresas</span>
            </a>
            <a class="flex items-center gap-3 px-3 py-2.5 rounded-lg hover:bg-slate-800 transition-colors" href="#">
                <span class="material-symbols-outlined text-xl">history_edu</span>
                <span class="text-sm font-medium">Procedimientos</span>
            </a>
            <div class="pt-6 pb-2 px-2 text-[10px] font-bold text-slate-500 uppercase tracking-widest">Administración</div>
            <a class="flex items-center gap-3 px-3 py-2.5 rounded-lg hover:bg-slate-800 transition-colors" href="#">
                <span class="material-symbols-outlined text-xl">group</span>
                <span class="text-sm font-medium">Usuarios</span>
            </a>
            <a class="flex items-center gap-3 px-3 py-2.5 rounded-lg hover:bg-slate-800 transition-colors" href="#">
                <span class="material-symbols-outlined text-xl">analytics</span>
                <span class="text-sm font-medium">Reportes</span>
            </a>
        </nav>
        <div class="p-4 border-t border-slate-800">
            <div class="flex items-center gap-3 bg-slate-800/50 p-3 rounded-xl">
                <div class="w-8 h-8 rounded-full bg-slate-700 flex items-center justify-center text-xs font-bold text-white">JD</div>
                <div class="flex-1 min-w-0">
                    <p class="text-xs font-bold text-white truncate">Juan Delgado</p>
                    <p class="text-[10px] text-slate-500">Administrador Gremial</p>
                </div>
                <span class="material-symbols-outlined text-slate-500 text-sm cursor-pointer">logout</span>
            </div>
        </div>
    </aside>
</div> *@


@if (PlatformService.IsNativeApp || IsMobile)
{
    <span>Es movil: @IsMobile </span>
    <div class="min-h-screen pb-24">
        <div class="sticky top-0 z-40 bg-white/80 ios-blur border-b border-slate-200">
            <div class="px-4 pt-6 pb-2">
                <div class="flex items-center justify-between mb-4">
                    <h1 class="text-3xl font-extrabold text-slate-900 tracking-tight">Empresas</h1>
                    <div class="w-8 h-8 rounded-full bg-slate-100 flex items-center justify-center">
                        <span class="material-symbols-outlined text-slate-600 text-xl">filter_list</span>
                    </div>
                </div>
            </div>
        </div>
    </div>
}
else
{
    <header class="h-16 bg-white border-b border-slate-200 flex items-center justify-between px-8 sticky top-0 z-10">
        <div class="flex items-center gap-4">
            <span class="text-sm text-slate-400">Directorio</span>
            <span class="material-symbols-outlined text-slate-300 text-sm">chevron_right</span>
            <span class="text-sm font-semibold text-slate-900">Listado Maestro</span>
        </div>
        <div class="flex items-center gap-6">
            <div class="flex items-center gap-3 bg-slate-100 rounded-full px-4 py-1.5 border border-slate-200">
                <span class="text-[10px] font-bold text-slate-600 uppercase tracking-tight">Admin Mode</span>
                <div class="w-8 h-4 bg-sky-500 rounded-full relative">
                    <div class="absolute right-0.5 top-0.5 w-3 h-3 bg-white rounded-full shadow-sm"></div>
                </div>
            </div>
            <div class="flex items-center gap-4 text-slate-400">
                <span class="material-symbols-outlined cursor-pointer hover:text-slate-600">notifications</span>
                <span class="material-symbols-outlined cursor-pointer hover:text-slate-600">settings</span>
            </div>
        </div>
    </header>
    <div class="p-8">
        <div class="flex justify-between items-end mb-8">
            <div>
                <h1 class="text-2xl font-bold text-slate-900 tracking-tight">Directorio de Entidades</h1>
                <p class="text-slate-500 text-sm mt-1">Gestión centralizada de empresas navieras y agencias marítimas.</p>
            </div>
            <!--<button class="bg-sky-600 hover:bg-sky-700 text-white px-5 py-2.5 rounded-xl font-bold text-sm shadow-lg shadow-sky-600/20 flex items-center gap-2 transition-all active:scale-95">
                <span class="material-symbols-outlined text-lg">add</span>
                                Registrar Empresa
            </button>-->
        </div>
        <div class="bg-white p-6 rounded-2xl border border-slate-200 shadow-sm mb-6">
            <div class="flex flex-col lg:flex-row gap-4 items-center">
                <div class="relative w-full lg:w-1/2 group">
                    <span class="material-symbols-outlined absolute left-4 top-1/2 -translate-y-1/2 text-slate-400 group-focus-within:text-sky-600 transition-colors">search</span>
                    <input @bind-value="_filtroBarco" 
                           @bind-value:event="oninput"
                           @onchange="() => OnFiltroChanged(_filtroBarco)"
                            class="w-full bg-slate-50 border-slate-200 rounded-xl py-3 pl-12 pr-4 text-sm focus:ring-4 focus:ring-sky-500/10 focus:border-sky-500 transition-all outline-none" placeholder="Buscar por RIF, Razón Social o Representante..." type="text"/>
                </div>
                <div class="flex gap-2 w-full lg:w-auto overflow-x-auto no-scrollbar pb-1">
                    <button class="px-5 py-2.5 rounded-xl bg-slate-900 text-white text-xs font-bold shrink-0">Todas</button>
                    <button class="px-5 py-2.5 rounded-xl bg-white border border-slate-200 text-slate-600 text-xs font-bold hover:bg-slate-50 shrink-0">Navieras</button>
                    <button class="px-5 py-2.5 rounded-xl bg-white border border-slate-200 text-slate-600 text-xs font-bold hover:bg-slate-50 shrink-0">Agencias de Estiba</button>
                    <button class="px-5 py-2.5 rounded-xl bg-white border border-slate-200 text-slate-600 text-xs font-bold hover:bg-slate-50 shrink-0">Astilleros</button>
                    <button class="px-5 py-2.5 rounded-xl bg-white border border-slate-200 text-slate-600 text-xs font-bold hover:bg-slate-50 shrink-0">Remolcadores</button>
                </div>
            </div>                
            
            <span class="text-xs font-bold text-slate-500 uppercase tracking-widest">Listado de Barcos y Empresas</span>

            <span class="text-[10px] font-mono text-slate-400">Total: @FiltroEmpresas.Count() embarcaciones</span>
        </div>
        <div class="bg-white rounded-2xl border border-slate-200 shadow-sm overflow-hidden">
            <div class="p-4 bg-slate-50/50 border-b border-slate-200 flex items-center justify-between">

                <div class="flex items-center gap-3">

                        <table class="w-full text-left border-collapse">
                        <thead>
                            <tr class="text-[11px] font-bold text-slate-400 uppercase tracking-wider border-b border-slate-100 bg-white">
                                <th class="px-6 py-4">Código</th>
                                <th class="px-6 py-4">Barco</th>
                                <th class="px-6 py-4">Armador</th>
                                <th class="px-6 py-4">Matrícula</th>
                                <th class="px-6 py-4">Capitán</th>
                                <th class="px-6 py-4">Puerto Base</th>
                                <th class="px-6 py-4">NIF Empresa</th>
                                <th class="px-6 py-4 text-right">Acciones</th>
                            </tr>
                        </thead>
                        <tbody class="divide-y divide-slate-100">
                        @if (EmpresasPaginadas != null && EmpresasPaginadas.Any())
                        {
                            @foreach (var empresa in EmpresasPaginadas)
                            {
                            <tr class="hover:bg-slate-50 transition-colors group">
                                <td class="px-6 py-5">
                                    <span class="text-sm font-mono font-bold text-slate-900">@empresa.CodigoBarco</span>
                                </td>
                                <td class="px-6 py-5">
                                    <div class="flex items-center gap-3">
                                        <div class="w-10 h-10 bg-sky-50 rounded-lg flex items-center justify-center border border-sky-100 shrink-0">
                                            <span class="material-symbols-outlined text-sky-600 text-xl">directions_boat</span>
                                        </div>
                                        <div>
                                            <p class="text-sm font-bold text-slate-900 group-hover:text-sky-700">@(empresa?.Barco?.NombreB ?? "Sin nombre")</p>
                                            <p class="text-[11px] text-slate-500">@(empresa?.Barco?.NombreA ?? "")</p>
                                        </div>
                                    </div>
                                </td>
                                <td class="px-6 py-5">
                                    <p class="text-sm font-medium text-slate-700">@(empresa.NombreArmador ?? "N/A")</p>
                                    <p class="text-[11px] text-slate-500">Código: @empresa.CodigoEmpresa</p>
                                </td>
                                <td class="px-6 py-5">
                                    <span class="text-xs font-mono font-medium text-slate-600 bg-slate-100 px-2 py-1 rounded">@(empresa?.Barco?.Matricula ?? "N/A")</span>
                                </td>
                                <td class="px-6 py-5">
                                    <span class="text-sm text-slate-600">@(empresa?.Barco?.CapitanNombre ?? "No asignado")</span>
                                </td>
                                <td class="px-6 py-5">
                                    <div class="flex items-center gap-2 text-slate-600">
                                        <span class="material-symbols-outlined text-base">anchor</span>
                                        <span class="text-xs font-medium">@(empresa.PuertoBase ?? "N/A")</span>
                                    </div>
                                </td>
                                <td class="px-6 py-5 text-sm font-mono text-slate-600">
                                    @(empresa.NIFE ?? "N/A")
                                </td>
                                <td class="px-6 py-5 text-right">
                                    <div class="flex items-center justify-end gap-2">
                                        <button @onclick="() => OpenTramites(empresa.CodigoEmpresa, empresa.Barco)" 
                                                class="w-8 h-8 rounded-lg flex items-center justify-center hover:bg-sky-50 text-slate-400 hover:text-sky-600 transition-all" 
                                                title="Ver Trámites">
                                            <span class="material-symbols-outlined text-lg">description</span>
                                        </button>
                                        <button @onclick='() => NavigationManager.NavigateTo($"/empresa/{empresa.CodigoEmpresa}")'
                                                class="w-8 h-8 rounded-lg flex items-center justify-center hover:bg-slate-200 text-slate-400 hover:text-slate-600 transition-all" 
                                                title="Ver Detalle">
                                            <span class="material-symbols-outlined text-lg">visibility</span>
                                        </button>
                                        <button class="w-8 h-8 rounded-lg flex items-center justify-center hover:bg-amber-50 text-slate-400 hover:text-amber-600 transition-all" 
                                                title="Editar">
                                            <span class="material-symbols-outlined text-lg">edit</span>
                                        </button>
                                    </div>
                                </td>
                            </tr>
                            }
                        }
                        else
                        {
                            <tr>
                                <td colspan="8" class="px-6 py-12 text-center text-slate-500">
                                    <div class="flex flex-col items-center gap-3">
                                        <span class="material-symbols-outlined text-6xl text-slate-300">sailing</span>
                                        <p class="text-sm font-medium">No se encontraron embarcaciones</p>
                                    </div>
                                </td>
                            </tr>
                        }
                    </tbody>
                    </table>
                    </div>
    
        </div>
            <div class="px-8 py-4 bg-slate-50 border-t border-slate-100 flex items-center justify-between">
                <div class="text-xs font-medium text-slate-500 flex items-center gap-4">
                    <span>
                        Mostrando <span class="text-slate-900">@RegistroInicio</span> a <span class="text-slate-900">@RegistroFin</span> de <span class="text-slate-900">@TotalRegistros</span> resultados
                    </span>
                    <div class="flex items-center gap-2">
                        <label class="text-slate-500">Mostrar:</label>
                        <select @onchange="e => CambiarItemsPorPagina(int.Parse(e.Value.ToString()))" 
                                class="px-2 py-1 border border-slate-200 rounded-lg text-xs focus:ring-2 focus:ring-sky-500/20 focus:border-sky-500 outline-none">
                            <option value="10" selected="@(_itemsPorPagina == 10)">10</option>
                            <option value="25" selected="@(_itemsPorPagina == 25)">25</option>
                            <option value="50" selected="@(_itemsPorPagina == 50)">50</option>
                            <option value="100" selected="@(_itemsPorPagina == 100)">100</option>
                        </select>
                    </div>
                </div>
                <div class="flex items-center gap-2">
                    <button @onclick="PaginaAnterior" 
                            disabled="@(_paginaActual <= 1)"
                            class="p-2 rounded-lg border border-slate-200 bg-white text-slate-400 hover:text-slate-900 transition-colors disabled:opacity-50 disabled:cursor-not-allowed">
                        <span class="material-symbols-outlined text-lg">chevron_left</span>
                    </button>
                    
                    @if (ObtenerNumerosPagina().FirstOrDefault() > 1)
                    {
                        <button @onclick="() => IrAPagina(1)" 
                                class="w-8 h-8 rounded-lg bg-white border border-slate-200 text-slate-600 text-xs font-medium hover:bg-slate-50">
                            1
                        </button>
                        @if (ObtenerNumerosPagina().FirstOrDefault() > 2)
                        {
                            <span class="text-slate-400">...</span>
                        }
                    }

                    @foreach (var numeroPagina in ObtenerNumerosPagina())
                    {
                        @if (numeroPagina == _paginaActual)
                        {
                            <button class="w-8 h-8 rounded-lg bg-sky-600 text-white text-xs font-bold">
                                @numeroPagina
                            </button>
                        }
                        else
                        {
                            <button @onclick="() => IrAPagina(numeroPagina)" 
                                    class="w-8 h-8 rounded-lg bg-white border border-slate-200 text-slate-600 text-xs font-medium hover:bg-slate-50">
                                @numeroPagina
                            </button>
                        }
                    }

                    @if (ObtenerNumerosPagina().Last() < TotalPaginas)
                    {
                        @if (ObtenerNumerosPagina().Last() < TotalPaginas - 1)
                        {
                            <span class="text-slate-400">...</span>
                        }
                        <button @onclick="() => IrAPagina(TotalPaginas)" 
                                class="w-8 h-8 rounded-lg bg-white border border-slate-200 text-slate-600 text-xs font-medium hover:bg-slate-50">
                            @TotalPaginas
                        </button>
                    }

                    <button @onclick="PaginaSiguiente" 
                            disabled="@(_paginaActual >= TotalPaginas)"
                            class="p-2 rounded-lg border border-slate-200 bg-white text-slate-400 hover:text-slate-900 transition-colors disabled:opacity-50 disabled:cursor-not-allowed">
                        <span class="material-symbols-outlined text-lg">chevron_right</span>
                    </button>
                </div>
            </div>
        </div>
    </div>
}

@code {

}
