@page "/barco/empresa/{CodigoEmpresa}/tramites/{CodigoBarco}"
@inject NavigationManager NavigationManager
@using CRM.Dtos
@using CRM.V3.Shared.Interfaces
@inject IApiClient<EmpresasDto> servicioEmpresas
@inject IApiClient<BarcosDto> servicioBarcos
@inject IApiClient<BarcosTramitesDto> servicioBarcosTramites
@inject IApiClient<UsuarioDto> servicioUsuarios

@*
    DETALLE DE BARCO
    ================
    
    Vista para visualizar y gestionar:
    - Información general del barco y empresa asociada
    - Trámites del barco (basados en BarcosTramitesDto)
    - Usuarios vinculados al barco/empresa (basados en UsuarioDto)
    
    Funcionalidades:
    - CRUD completo de trámites para el barco
    - CRUD completo de usuarios asociados al barco/empresa
    - Visualizar estado de trámites por fechas (Vigentes, Por Vencer, Vencidos)
*@

<PageTitle>Barco: @barco?.NombreB</PageTitle>

@if (isLoading)
{
    <div class="flex items-center justify-center min-h-screen">
        <div class="text-center">
            <div class="inline-block animate-spin rounded-full h-12 w-12 border-b-2 border-sky-600"></div>
            <p class="mt-4 text-slate-600">Cargando información del barco...</p>
        </div>
    </div>
}
else if (barco == null)
{
    <div class="flex items-center justify-center min-h-screen">
        <div class="text-center">
            <span class="material-symbols-outlined text-6xl text-slate-400 mb-4">sailing</span>
            <p class="text-xl text-slate-600">Barco no encontrado</p>
            <button @onclick='() => NavigationManager.NavigateTo("/barcos")' 
                    class="mt-4 px-6 py-2 bg-sky-600 text-white rounded-lg hover:bg-sky-700">
                Volver al listado
            </button>
        </div>
    </div>
}
else
{
    <!-- Main Content -->
    <div class="w-full p-4 md:p-6 lg:p-8">
        
        <!-- Header con info de barco -->
        <div class="bg-gradient-to-br from-sky-50 to-blue-100 rounded-2xl border-2 border-sky-200 p-6 md:p-8 mb-6 shadow-lg">
            <div class="flex flex-col md:flex-row md:items-center gap-6">
                <div class="bg-gradient-to-br from-sky-500 to-blue-600 text-white shrink-0 w-20 h-20 md:w-24 md:h-24 flex items-center justify-center rounded-2xl font-bold text-3xl shadow-xl">
                    <span class="material-symbols-outlined text-5xl">directions_boat</span>
                </div>
                <div class="flex-1">
                    <div class="flex items-start justify-between gap-4">
                        <div>
                            <h1 class="text-2xl md:text-3xl lg:text-4xl font-bold text-slate-900 mb-2">
                                @barco.NombreB
                            </h1>
                            <div class="flex flex-wrap items-center gap-4 text-sm md:text-base text-slate-600">
                                <div class="flex items-center gap-2">
                                    <span class="material-symbols-outlined text-sky-600">tag</span>
                                    <span class="font-mono font-semibold">Matrícula: @barco.Matricula</span>
                                </div>
                                <div class="flex items-center gap-2">
                                    <span class="material-symbols-outlined text-sky-600">badge</span>
                                    <span>Código: @barco.CodigoBarco</span>
                                </div>
                                @if (!string.IsNullOrEmpty(barco.CapitanNombre))
                                {
                                    <div class="flex items-center gap-2">
                                        <span class="material-symbols-outlined text-sky-600">person</span>
                                        <span>Capitán: @barco.CapitanNombre</span>
                                    </div>
                                }
                            </div>
                            @if (empresa != null)
                            {
                                <div class="mt-2 text-sm text-slate-600">
                                    <span class="font-semibold">Armador:</span> @empresa.NombreArmador
                                </div>
                            }
                        </div>
                        <button @onclick='() => NavigationManager.NavigateTo("/barcos")' 
                                class="text-slate-400 hover:text-slate-600">
                            <span class="material-symbols-outlined text-3xl">close</span>
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Stats Cards -->
        <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4 md:gap-6 mb-6">
            <!-- Total Trámites -->
            <div class="bg-white rounded-xl border border-slate-200 p-6 hover:shadow-xl transition-all duration-300 hover:scale-105">
                <div class="flex items-center justify-between mb-4">
                    <div class="bg-slate-100 w-12 h-12 flex items-center justify-center rounded-xl">
                        <span class="material-symbols-outlined text-slate-600 text-2xl">description</span>
                    </div>
                    <span class="text-3xl font-bold text-slate-900">@totalTramites</span>
                </div>
                <h3 class="text-slate-600 font-medium text-sm">Total Trámites</h3>
            </div>

            <!-- Vigentes -->
            <div class="bg-white rounded-xl border border-sky-200 p-6 hover:shadow-xl transition-all duration-300 hover:scale-105">
                <div class="flex items-center justify-between mb-4">
                    <div class="bg-sky-100 w-12 h-12 flex items-center justify-center rounded-xl">
                        <span class="material-symbols-outlined text-sky-600 text-2xl">check_circle</span>
                    </div>
                    <span class="text-3xl font-bold text-sky-600">@tramitesVigentes</span>
                </div>
                <h3 class="text-slate-600 font-medium text-sm">Vigentes</h3>
            </div>

            <!-- Por Vencer -->
            <div class="bg-white rounded-xl border border-amber-200 p-6 hover:shadow-xl transition-all duration-300 hover:scale-105">
                <div class="flex items-center justify-between mb-4">
                    <div class="bg-amber-100 w-12 h-12 flex items-center justify-center rounded-xl">
                        <span class="material-symbols-outlined text-amber-600 text-2xl">warning</span>
                    </div>
                    <span class="text-3xl font-bold text-amber-600">@tramitesPorVencer</span>
                </div>
                <h3 class="text-slate-600 font-medium text-sm">Por Vencer (30 días)</h3>
            </div>

            <!-- Vencidos -->
            <div class="bg-white rounded-xl border border-red-200 p-6 hover:shadow-xl transition-all duration-300 hover:scale-105">
                <div class="flex items-center justify-between mb-4">
                    <div class="bg-red-100 w-12 h-12 flex items-center justify-center rounded-xl">
                        <span class="material-symbols-outlined text-red-600 text-2xl">error</span>
                    </div>
                    <span class="text-3xl font-bold text-red-600">@tramitesVencidos</span>
                </div>
                <h3 class="text-slate-600 font-medium text-sm">Vencidos</h3>
            </div>
        </div>

        <!-- Tabs System -->
        <div class="bg-white rounded-2xl border border-slate-200 shadow-sm overflow-hidden">
            <!-- Tab Headers -->
            <div class="flex border-b border-slate-200">
                <button @onclick='() => tabActiva = "tramites"'
                        class="@(tabActiva == "tramites" ? "border-b-2 border-sky-600 text-sky-600" : "text-slate-600") flex-1 px-6 py-4 font-semibold hover:bg-slate-50 transition-colors flex items-center justify-center gap-2">
                    <span class="material-symbols-outlined">description</span>
                    <span>Trámites (@totalTramites)</span>
                </button>
                <button @onclick='() => tabActiva = "usuarios"'
                        class="@(tabActiva == "usuarios" ? "border-b-2 border-green-600 text-green-600" : "text-slate-600") flex-1 px-6 py-4 font-semibold hover:bg-slate-50 transition-colors flex items-center justify-center gap-2">
                    <span class="material-symbols-outlined">group</span>
                    <span>Usuarios (@usuariosBarco.Count)</span>
                </button>
            </div>

            <!-- Tab Content -->
            <div class="p-6">
                @if (tabActiva == "tramites")
                {
                    <!-- Trámites Tab -->
                    <div class="space-y-4">
                        <div class="flex items-center justify-between mb-6">
                            <h2 class="text-xl font-bold text-slate-900">Trámites del Barco</h2>
                            <button @onclick="MostrarFormularioTramite"
                                    class="bg-sky-600 hover:bg-sky-700 text-white px-4 py-2 rounded-lg font-semibold text-sm flex items-center gap-2 transition-all">
                                <span class="material-symbols-outlined text-lg">add</span>
                                Nuevo Trámite
                            </button>
                        </div>

                        @if (tramites.Any())
                        {
                            <div class="grid grid-cols-1 gap-4">
                                @foreach (var tramite in tramites.OrderByDescending(t => t.FechaFin))
                                {
                                    var hoy = DateTime.Now;
                                    var diasRestantes = tramite.FechaFin.HasValue ? (tramite.FechaFin.Value - hoy).Days : 0;
                                    var estadoTexto = diasRestantes < 0 ? "Vencido" : (diasRestantes <= 30 ? "Por Vencer" : "Vigente");
                                    var borderClass = diasRestantes < 0 ? "border-red-500" : (diasRestantes <= 30 ? "border-amber-500" : "border-sky-500");
                                    var bgClass = diasRestantes < 0 ? "bg-red-100" : (diasRestantes <= 30 ? "bg-amber-100" : "bg-sky-100");
                                    var textClass = diasRestantes < 0 ? "text-red-600" : (diasRestantes <= 30 ? "text-amber-600" : "text-sky-600");

                                    <div class="bg-slate-50 rounded-xl p-5 border-l-4 @borderClass hover:shadow-lg transition-all">
                                        <div class="flex items-start justify-between gap-4">
                                            <div class="flex-1">
                                                <div class="flex items-start gap-4">
                                                    <div class="@bgClass w-14 h-14 flex items-center justify-center rounded-xl shrink-0">
                                                        <span class="material-symbols-outlined @textClass text-2xl">description</span>
                                                    </div>
                                                    <div class="flex-1">
                                                        <h3 class="text-lg font-bold text-slate-900 mb-2">@tramite.Certificado</h3>
                                                        <div class="grid grid-cols-1 md:grid-cols-2 gap-3 text-sm">
                                                            <div class="flex items-center gap-2 text-slate-600">
                                                                <span class="material-symbols-outlined text-base">event</span>
                                                                <span>Inicio: <strong>@tramite.FechaInicio?.ToString("dd/MM/yyyy")</strong></span>
                                                            </div>
                                                            <div class="flex items-center gap-2 text-slate-600">
                                                                <span class="material-symbols-outlined text-base">event_available</span>
                                                                <span>Fin: <strong>@tramite.FechaFin?.ToString("dd/MM/yyyy")</strong></span>
                                                            </div>
                                                            <div class="flex items-center gap-2 @textClass">
                                                                <span class="material-symbols-outlined text-base">schedule</span>
                                                                <span class="font-semibold">@estadoTexto (@diasRestantes días)</span>
                                                            </div>
                                                            @if (!string.IsNullOrEmpty(tramite.ListaEmailsEnvioAviso))
                                                            {
                                                                <div class="flex items-center gap-2 text-slate-600">
                                                                    <span class="material-symbols-outlined text-base">mail</span>
                                                                    <span class="text-xs">Avisos programados</span>
                                                                </div>
                                                            }
                                                        </div>
                                                        @if (!string.IsNullOrEmpty(tramite.Observaciones))
                                                        {
                                                            <div class="mt-3 p-2 bg-white rounded text-xs text-slate-600">
                                                                @tramite.Observaciones
                                                            </div>
                                                        }
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="flex gap-2">
                                                <button @onclick="() => EditarTramite(tramite)"
                                                        class="w-9 h-9 rounded-lg flex items-center justify-center bg-amber-50 text-amber-600 hover:bg-amber-100 hover:text-amber-700 transition-all border border-amber-200"
                                                        title="Editar">
                                                    <span class="material-symbols-outlined text-lg">edit</span>
                                                </button>
                                                <button @onclick="() => EliminarTramite(tramite.Id)"
                                                        class="w-9 h-9 rounded-lg flex items-center justify-center bg-red-50 text-red-600 hover:bg-red-100 hover:text-red-700 transition-all border border-red-200"
                                                        title="Eliminar">
                                                    <span class="material-symbols-outlined text-lg">delete</span>
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                }
                            </div>
                        }
                        else
                        {
                            <div class="text-center py-12">
                                <span class="material-symbols-outlined text-6xl text-slate-300 mb-3">description</span>
                                <p class="text-slate-500">No hay trámites registrados</p>
                                <p class="text-sm text-slate-400 mt-1">Crea el primer trámite para este barco</p>
                            </div>
                        }
                    </div>
                }
                else if (tabActiva == "usuarios")
                {
                    <!-- Usuarios Tab -->
                    <div class="space-y-4">
                        <div class="flex items-center justify-between mb-6">
                            <h2 class="text-xl font-bold text-slate-900">Usuarios del Barco</h2>
                            <button @onclick="MostrarFormularioUsuario"
                                    class="bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-lg font-semibold text-sm flex items-center gap-2 transition-all">
                                <span class="material-symbols-outlined text-lg">person_add</span>
                                Nuevo Usuario
                            </button>
                        </div>

                        @if (usuariosBarco.Any())
                        {
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                @foreach (var usuario in usuariosBarco.OrderBy(u => u.Nombre))
                                {
                                    <div class="bg-slate-50 rounded-xl p-5 hover:shadow-lg transition-all">
                                        <div class="flex items-start gap-4">
                                            <div class="bg-gradient-to-br from-green-500 to-emerald-600 text-white w-14 h-14 flex items-center justify-center rounded-xl font-bold text-lg shrink-0">
                                                @GetInicialesUsuario(usuario.Nombre, usuario.Apellidos)
                                            </div>
                                            <div class="flex-1 min-w-0">
                                                <div class="flex items-start justify-between gap-2">
                                                    <div class="flex-1 min-w-0">
                                                        <h3 class="text-lg font-bold text-slate-900 truncate">
                                                            @usuario.Nombre @usuario.Apellidos
                                                        </h3>
                                                        <div class="flex items-center gap-2 mt-1">
                                                            <span class="px-2 py-1 bg-green-100 text-green-700 text-xs font-semibold rounded">
                                                                @usuario.Rol
                                                            </span>
                                                            <span class="px-2 py-1 @((usuario.Activo == true) ? "bg-sky-100 text-sky-700" : "bg-slate-200 text-slate-600") text-xs font-semibold rounded">
                                                                @((usuario.Activo == true) ? "Activo" : "Inactivo")
                                                            </span>
                                                        </div>
                                                    </div>
                                                    <div class="flex gap-1">
                                                        <button @onclick="() => EditarUsuario(usuario)"
                                                                class="w-8 h-8 rounded-lg flex items-center justify-center bg-amber-50 text-amber-600 hover:bg-amber-100 hover:text-amber-700 transition-all border border-amber-200"
                                                                title="Editar">
                                                            <span class="material-symbols-outlined text-base">edit</span>
                                                        </button>
                                                        <button @onclick="() => EliminarUsuario(usuario.Id)"
                                                                class="w-8 h-8 rounded-lg flex items-center justify-center bg-red-50 text-red-600 hover:bg-red-100 hover:text-red-700 transition-all border border-red-200"
                                                                title="Eliminar">
                                                            <span class="material-symbols-outlined text-base">delete</span>
                                                        </button>
                                                    </div>
                                                </div>
                                                <div class="mt-3 space-y-1 text-sm text-slate-600">
                                                    @if (!string.IsNullOrEmpty(usuario.EMail))
                                                    {
                                                        <div class="flex items-center gap-2">
                                                            <span class="material-symbols-outlined text-base">mail</span>
                                                            <span class="truncate">@usuario.EMail</span>
                                                        </div>
                                                    }
                                                    @if (!string.IsNullOrEmpty(usuario.Telefono))
                                                    {
                                                        <div class="flex items-center gap-2">
                                                            <span class="material-symbols-outlined text-base">phone</span>
                                                            <span>@usuario.Telefono</span>
                                                        </div>
                                                    }
                                                    <div class="flex items-center gap-2 text-xs text-slate-500">
                                                        <span class="material-symbols-outlined text-base">calendar_today</span>
                                                        <span>Registro: @usuario.FechaRegistro?.ToString("dd/MM/yyyy")</span>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                }
                            </div>
                        }
                        else
                        {
                            <div class="text-center py-12">
                                <span class="material-symbols-outlined text-6xl text-slate-300 mb-3">group</span>
                                <p class="text-slate-500">No hay usuarios registrados</p>
                                <p class="text-sm text-slate-400 mt-1">Agrega el primer usuario para este barco</p>
                            </div>
                        }
                    </div>
                }
            </div>
        </div>
    </div>

    <!-- Modal para Trámite -->
    @if (mostrarFormTramite)
    {
        <div class="fixed inset-0 bg-black/50 flex items-center justify-center p-4 z-50" @onclick="CerrarFormularioTramite">
            <div class="bg-white rounded-2xl max-w-2xl w-full max-h-[90vh] overflow-y-auto" @onclick:stopPropagation="true">
                <div class="sticky top-0 bg-white border-b border-slate-200 px-6 py-4 flex items-center justify-between">
                    <h2 class="text-xl font-bold text-slate-900">
                        @(tramiteEditando != null ? "Editar Trámite" : "Nuevo Trámite")
                    </h2>
                    <button @onclick="CerrarFormularioTramite" class="text-slate-400 hover:text-slate-600">
                        <span class="material-symbols-outlined text-2xl">close</span>
                    </button>
                </div>
                <div class="p-6 space-y-4">
                    <div>
                        <label class="block text-sm font-semibold text-slate-700 mb-2">Certificado/Trámite *</label>
                        <input @bind="nuevoTramite.Certificado" 
                               class="w-full px-4 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-sky-500 focus:border-sky-500 outline-none"
                               placeholder="Ej: Certificado de Matrícula" />
                    </div>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            <label class="block text-sm font-semibold text-slate-700 mb-2">Fecha Inicio *</label>
                            <input type="date" @bind="nuevoTramite.FechaInicio" 
                                   class="w-full px-4 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-sky-500 focus:border-sky-500 outline-none" />
                        </div>
                        <div>
                            <label class="block text-sm font-semibold text-slate-700 mb-2">Fecha Fin *</label>
                            <input type="date" @bind="nuevoTramite.FechaFin" 
                                   class="w-full px-4 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-sky-500 focus:border-sky-500 outline-none" />
                        </div>
                    </div>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            <label class="block text-sm font-semibold text-slate-700 mb-2">Fecha Aviso</label>
                            <input type="date" @bind="nuevoTramite.FechaAviso" 
                                   class="w-full px-4 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-sky-500 focus:border-sky-500 outline-none" />
                        </div>
                        <div>
                            <label class="block text-sm font-semibold text-slate-700 mb-2">Días de Aviso</label>
                            <input type="number" @bind="nuevoTramite.DiasAvisoTramite" 
                                   class="w-full px-4 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-sky-500 focus:border-sky-500 outline-none"
                                   placeholder="30" />
                        </div>
                    </div>
                    <div>
                        <label class="block text-sm font-semibold text-slate-700 mb-2">Emails para Avisos (separados por coma)</label>
                        <input @bind="nuevoTramite.ListaEmailsEnvioAviso" 
                               class="w-full px-4 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-sky-500 focus:border-sky-500 outline-none"
                               placeholder="email1@example.com, email2@example.com" />
                    </div>
                    <div>
                        <label class="block text-sm font-semibold text-slate-700 mb-2">Observaciones</label>
                        <textarea @bind="nuevoTramite.Observaciones" rows="3"
                                  class="w-full px-4 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-sky-500 focus:border-sky-500 outline-none"
                                  placeholder="Notas adicionales sobre el trámite..."></textarea>
                    </div>
                </div>
                <div class="sticky bottom-0 bg-slate-50 border-t border-slate-200 px-6 py-4 flex justify-end gap-3">
                    <button @onclick="CerrarFormularioTramite"
                            class="px-6 py-2 border border-slate-300 text-slate-700 rounded-lg hover:bg-slate-100 font-semibold">
                        Cancelar
                    </button>
                    <button @onclick="GuardarTramite"
                            class="px-6 py-2 bg-sky-600 text-white rounded-lg hover:bg-sky-700 font-semibold">
                        @(tramiteEditando != null ? "Actualizar" : "Guardar")
                    </button>
                </div>
            </div>
        </div>
    }

    <!-- Modal para Usuario -->
    @if (mostrarFormUsuario)
    {
        <div class="fixed inset-0 bg-black/50 flex items-center justify-center p-4 z-50" @onclick="CerrarFormularioUsuario">
            <div class="bg-white rounded-2xl max-w-2xl w-full max-h-[90vh] overflow-y-auto" @onclick:stopPropagation="true">
                <div class="sticky top-0 bg-white border-b border-slate-200 px-6 py-4 flex items-center justify-between">
                    <h2 class="text-xl font-bold text-slate-900">
                        @(usuarioEditando != null ? "Editar Usuario" : "Nuevo Usuario")
                    </h2>
                    <button @onclick="CerrarFormularioUsuario" class="text-slate-400 hover:text-slate-600">
                        <span class="material-symbols-outlined text-2xl">close</span>
                    </button>
                </div>
                <div class="p-6 space-y-4">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            <label class="block text-sm font-semibold text-slate-700 mb-2">Nombre *</label>
                            <input @bind="nuevoUsuario.Nombre" 
                                   class="w-full px-4 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500 outline-none"
                                   placeholder="Nombre" />
                        </div>
                        <div>
                            <label class="block text-sm font-semibold text-slate-700 mb-2">Apellidos *</label>
                            <input @bind="nuevoUsuario.Apellidos" 
                                   class="w-full px-4 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500 outline-none"
                                   placeholder="Apellidos" />
                        </div>
                    </div>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            <label class="block text-sm font-semibold text-slate-700 mb-2">Email *</label>
                            <input type="email" @bind="nuevoUsuario.EMail" 
                                   class="w-full px-4 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500 outline-none"
                                   placeholder="correo@ejemplo.com" />
                        </div>
                        <div>
                            <label class="block text-sm font-semibold text-slate-700 mb-2">Teléfono</label>
                            <input type="tel" @bind="nuevoUsuario.Telefono" 
                                   class="w-full px-4 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500 outline-none"
                                   placeholder="+34 XXX XXX XXX" />
                        </div>
                    </div>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            <label class="block text-sm font-semibold text-slate-700 mb-2">NIF *</label>
                            <input @bind="nuevoUsuario.NIFAcceso" 
                                   class="w-full px-4 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500 outline-none"
                                   placeholder="12345678A" />
                        </div>
                        <div>
                            <label class="block text-sm font-semibold text-slate-700 mb-2">Rol *</label>
                            <select @bind="nuevoUsuario.Rol" 
                                    class="w-full px-4 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500 outline-none">
                                <option value="Cliente">Cliente</option>
                                <option value="Administrador">Administrador</option>
                                <option value="Asistente">Asistente</option>
                            </select>
                        </div>
                    </div>
                    @if (usuarioEditando == null)
                    {
                        <div>
                            <label class="block text-sm font-semibold text-slate-700 mb-2">Contraseña *</label>
                            <input type="password" @bind="nuevoUsuario.PasswordHash" 
                                   class="w-full px-4 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500 outline-none"
                                   placeholder="Contraseña segura" />
                        </div>
                    }
                    <div>
                        <label class="block text-sm font-semibold text-slate-700 mb-2">Email para Avisos</label>
                        <input type="email" @bind="nuevoUsuario.EMailAvisos" 
                               class="w-full px-4 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500 outline-none"
                               placeholder="Por defecto se usa el email principal" />
                    </div>
                    <div class="flex items-center gap-3">
                        <input type="checkbox" @bind="nuevoUsuario.Activo" 
                               class="w-5 h-5 text-green-600 border-slate-300 rounded focus:ring-2 focus:ring-green-500" 
                               id="usuarioActivo" />
                        <label for="usuarioActivo" class="text-sm font-semibold text-slate-700">Usuario Activo</label>
                    </div>
                </div>
                <div class="sticky bottom-0 bg-slate-50 border-t border-slate-200 px-6 py-4 flex justify-end gap-3">
                    <button @onclick="CerrarFormularioUsuario"
                            class="px-6 py-2 border border-slate-300 text-slate-700 rounded-lg hover:bg-slate-100 font-semibold">
                        Cancelar
                    </button>
                    <button @onclick="GuardarUsuario"
                            class="px-6 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 font-semibold">
                        @(usuarioEditando != null ? "Actualizar" : "Guardar")
                    </button>
                </div>
            </div>
        </div>
    }
}

@code {

}
