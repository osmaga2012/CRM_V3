services:
- type: static
  name: crm-v3-web
  region: oregon
  plan: free
  buildCommand: |
    # Instalar .NET SDK 10
    curl -sSL https://dot.net/v1/dotnet-install.sh | bash /dev/stdin --version 10.0.103
    export PATH="$PATH:$HOME/.dotnet"
    export DOTNET_ROOT=$HOME/.dotnet
      
    # Restaurar cargas de trabajo necesarias
    dotnet workload restore
      
    # Restaurar paquetes NuGet
    dotnet restore CRM.V3/CRM.V3.Web/CRM.V3.Web.csproj
      
    # Publicar la aplicación como estáticos
    dotnet publish CRM.V3/CRM.V3.Web/CRM.V3.Web.csproj -c Release -o publish
    
  # Directorio donde están los archivos estáticos publicados
  publishPath: publish/wwwroot
    
  # Configuración de rutas para SPA
  routes:
    - type: rewrite
      source: /*
      destination: /index.html
    
  # Headers para archivos WASM
  headers:
    - path: /_framework/*.wasm
      name: Content-Type
      value: application/wasm
    - path: /_framework/*.dll
      name: Content-Type
      value: application/octet-stream
    - path: /_framework/*.dat
      name: Content-Type
      value: application/octet-stream
    - path: /_framework/*.blat
      name: Content-Type
      value: application/octet-stream
    
  envVars:
    - key: GITHUB_ACTIONS
      value: "true"
